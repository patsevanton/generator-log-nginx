# Nginx Log Generator

Этот проект является форком https://github.com/kscarlett/nginx-log-generator с изменённой логикой генерации логов.

Утилита на Go для генерации реалистичных логов Nginx в формате JSON. Она предназначена для тестирования пайплайнов сбора логов, демонстрации работы в Kubernetes и других сценариях, требующих реалистичных данных логов.

Большая часть данных генерируется с помощью библиотеки [gofakeit](https://github.com/brianvoe/gofakeit).

## Основные изменения в форке

В отличие от исходной версии, в этой реализации **все основные параметры логов задаются через обязательные переменные окружения**, что обеспечивает полный контроль над генерируемыми данными:

- **IP_ADDRESSES** - список IP-адресов
- **HTTP_METHODS** - список HTTP-методов
- **PATHS** - список URL-путей
- **STATUS_CODES** - список HTTP-статус кодов

## Сборка из исходного кода

Для сборки бинарного файла из исходного кода:

1. Убедитесь, что у вас установлен Go (версия 1.25 или выше)
2. Выполните сборку:
```shell
go build -o nginx-log-generator .
```

## Использование

### Основные обязательные переменные окружения

```shell
# Минимальный пример запуска
IP_ADDRESSES="192.168.1.1,10.0.0.1" \
HTTP_METHODS="GET,POST" \
PATHS="/api/v1/users,/api/v1/products,/health" \
STATUS_CODES="200,201,400,404,500" \
RATE=5 \
./nginx-log-generator
```

### Запуск через Docker

```shell
docker pull ghcr.io/patsevanton/generator-log-nginx:latest

docker run \
  -e "IP_ADDRESSES=192.168.1.1,10.0.0.1" \
  -e "HTTP_METHODS=GET,POST,PUT" \
  -e "PATHS=/api/v1/users,/api/v1/products" \
  -e "STATUS_CODES=200,400,500" \
  -e "RATE=10" \
  ghcr.io/patsevanton/generator-log-nginx:latest
```

### Конфигурация

Все переменные окружения являются обязательными, кроме тех, что имеют значение по умолчанию:

| Название              | Обязательный | По умолчанию | Описание                                                                 |
| --------------------- | ------------ | ------------ | ------------------------------------------------------------------------ |
| **IP_ADDRESSES**      | **Да**       | -            | Список IP-адресов через запятую (например, "192.168.1.1,10.0.0.1")      |
| **HTTP_METHODS**      | **Да**       | -            | Список HTTP-методов через запятую (например, "GET,POST,PUT")            |
| **PATHS**             | **Да**       | -            | Список путей через запятую (например, "/api/v1/users,/api/v1/products") |
| **STATUS_CODES**      | **Да**       | -            | Список кодов статуса через запятую (например, "200,400,404,500")        |
| RATE                  | Нет          | 1            | Количество логов в секунду                                               |
| PATH_MIN              | Нет          | 1            | Минимальная длина пути                                                   |
| PATH_MAX              | Нет          | 5            | Максимальная длина пути                                                  |

**Примечание**: Все переменные с процентами (`IPV4_PERCENT`, `STATUS_OK_PERCENT`, `GET_PERCENT`, `POST_PERCENT`, `PUT_PERCENT`, `PATCH_PERCENT`, `DELETE_PERCENT`) из оригинальной версии больше не используются, так как все значения выбираются случайно из предоставленных списков.

## Пример выходных данных

Программа выводит логи в формате JSON с префиксом:
```
ingress-nginx-controller controller {"ts":"2023-10-01T12:00:00Z","http":{...},"nginx":{...}}
```

Пример полной записи лога:
```json
{
  "ts": "2023-10-01T12:00:00Z",
  "http": {
    "request_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "method": "GET",
    "status_code": 200,
    "url": "example.com/api/v1/users",
    "host": "example.com",
    "uri": "/api/v1/users",
    "request_time": 0.123,
    "user_agent": "Mozilla/5.0...",
    "protocol": "HTTP/1.1",
    "trace_session_id": "",
    "server_protocol": "HTTP/1.1",
    "content_type": "application/json",
    "bytes_sent": "1500"
  },
  "nginx": {
    "x-forward-for": "192.168.1.1",
    "remote_addr": "192.168.1.1",
    "http_referrer": "http://referrer.com/some-path"
  }
}
```

## Особенности реализации

1. **Случайный выбор**: Все значения (IP, метод, путь, статус код) выбираются случайным образом из предоставленных списков
2. **Реалистичные данные**: Размер отправляемых байт зависит от статус кода (ошибки имеют меньший размер)
3. **Автоматическая генерация**: Запросы ID, User-Agent, домены и рефереры генерируются автоматически
4. **Контроль частоты**: Точный контроль количества логов в секунду через параметр `RATE`

## Лицензия

Этот инструмент распространяется под лицензией [MIT License](LICENSE).
